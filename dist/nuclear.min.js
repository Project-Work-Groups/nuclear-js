!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("immutable")):"function"==typeof define&&define.amd?define(["immutable"],e):"object"==typeof exports?exports.Nuclear=e(require("immutable")):t.Nuclear=e(t.Immutable)}(this,function(t){return function(t){function e(i){if(r[i])return r[i].exports;var n=r[i]={exports:{},id:i,loaded:!1};return t[i].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){var i=r(1);e.Reactor=r(4),e.Store=r(13),e.Immutable=r(2),e.isKeyPath=r(10).isKeyPath,e.isGetter=r(9).isGetter,e.toJS=i.toJS,e.toImmutable=i.toImmutable,e.isImmutable=i.isImmutable,e.createReactMixin=r(12)},function(t,e,r){function i(t){return s.Iterable.isIterable(t)}function n(t){return i(t)||!u(t)}function o(t){return i(t)?t.toJS():t}function a(t){return i(t)?t:s.fromJS(t)}var s=r(2),u=r(3).isObject;e.toJS=o,e.toImmutable=a,e.isImmutable=i,e.isImmutableValue=n},function(e,r){e.exports=t},function(t,e){function r(t){return t&&"object"==typeof t&&toString.call(t)}function i(t){return"number"==typeof t&&t>-1&&t%1===0&&t<=Number.MAX_VALUE}e.isString=function(t){return"string"==typeof t||"[object String]"===r(t)},e.isArray=Array.isArray||function(t){return"[object Array]"===r(t)},"function"!=typeof/./&&"object"!=typeof Int8Array?e.isFunction=function(t){return"function"==typeof t||!1}:e.isFunction=function(t){return"[object Function]"===toString.call(t)},e.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},e.extend=function(t){var e=arguments.length;if(!t||e<2)return t||{};for(var r=1;r<e;r++)for(var i=arguments[r],n=Object.keys(i),o=n.length,a=0;a<o;a++){var s=n[a];t[s]=i[s]}return t},e.clone=function(t){return e.isObject(t)?e.isArray(t)?t.slice():e.extend({},t):t},e.each=function(t,e,r){var n,o,a=t?t.length:0,s=-1;if(r&&(o=e,e=function(t,e,i){return o.call(r,t,e,i)}),i(a))for(;++s<a&&e(t[s],s,t)!==!1;);else for(n=Object.keys(t),a=n.length;++s<a&&e(t[n[s]],n[s],t)!==!1;);return t},e.partial=function(t){var e=Array.prototype.slice,r=e.call(arguments,1);return function(){return t.apply(this,r.concat(e.call(arguments)))}}},function(t,e,r){function i(t){"use strict";return this instanceof i?(t=t||{},this.debug=!!t.debug,this.ReactMixin=h(this),this.state=n.Map({}),this.__stores=n.Map({}),this.__evaluator=new c,this.__changeObserver=new a(this.state,this.__evaluator),this.__batchDepth=0,this.__batchDispatchCount=0,void(this.__isDispatching=!1)):new i(t)}var n=r(2),o=r(5),a=r(6),s=r(9),u=r(10),c=r(11),h=r(12),l=r(1).toJS,f=r(1).toImmutable,p=r(1).isImmutableValue,_=r(3).each;Object.defineProperty(i.prototype,"evaluate",{writable:!0,configurable:!0,value:function(t){"use strict";return this.__evaluator.evaluate(this.state,t)}}),Object.defineProperty(i.prototype,"evaluateToJS",{writable:!0,configurable:!0,value:function(t){"use strict";return l(this.evaluate(t))}}),Object.defineProperty(i.prototype,"observe",{writable:!0,configurable:!0,value:function(t,e){"use strict";return 1===arguments.length?(e=t,t=s.fromKeyPath([])):u.isKeyPath(t)&&(t=s.fromKeyPath(t)),this.__changeObserver.onChange(t,e)}}),Object.defineProperty(i.prototype,"dispatch",{writable:!0,configurable:!0,value:function(t,e){"use strict";if(0===this.__batchDepth){if(this.__isDispatching)throw this.__isDispatching=!1,new Error("Dispatch may not be called while a dispatch is in progress");this.__isDispatching=!0}var r=this.state;try{this.state=this.__handleAction(r,t,e)}catch(t){throw this.__isDispatching=!1,t}if(this.__batchDepth>0)this.__batchDispatchCount++;else{if(this.state!==r)try{this.__notify()}catch(t){throw this.__isDispatching=!1,t}this.__isDispatching=!1}}}),Object.defineProperty(i.prototype,"batch",{writable:!0,configurable:!0,value:function(t){"use strict";this.__batchStart(),t(),this.__batchEnd()}}),Object.defineProperty(i.prototype,"registerStore",{writable:!0,configurable:!0,value:function(t,e){"use strict";console.warn("Deprecation warning: `registerStore` will no longer be supported in 1.1, use `registerStores` instead");var r={};r[t]=e,this.registerStores(r)}}),Object.defineProperty(i.prototype,"registerStores",{writable:!0,configurable:!0,value:function(t){"use strict";_(t,function(t,e){this.__stores.get(e)&&console.warn("Store already defined for id = "+e);var r=t.getInitialState();if(this.debug&&!p(r))throw new Error("Store getInitialState() must return an immutable value, did you forget to call toImmutable");this.__stores=this.__stores.set(e,t),this.state=this.state.set(e,r)}.bind(this)),this.__notify()}}),Object.defineProperty(i.prototype,"serialize",{writable:!0,configurable:!0,value:function(){"use strict";var t={};return this.__stores.forEach(function(e,r){var i=this.state.get(r),n=e.serialize(i);void 0!==n&&(t[r]=n)}.bind(this)),t}}),Object.defineProperty(i.prototype,"loadState",{writable:!0,configurable:!0,value:function(t){"use strict";var e=f({}).withMutations(function(e){_(t,function(t,r){var i=this.__stores.get(r);if(i){var n=i.deserialize(t);void 0!==n&&e.set(r,n)}}.bind(this))}.bind(this));this.state=this.state.merge(e),this.__notify()}}),Object.defineProperty(i.prototype,"reset",{writable:!0,configurable:!0,value:function(){"use strict";var t=this.debug,e=this.state;this.state=n.Map().withMutations(function(r){this.__stores.forEach(function(i,n){var o=e.get(n),a=i.handleReset(o);if(t&&void 0===a)throw new Error("Store handleReset() must return a value, did you forget a return statement");if(t&&!p(a))throw new Error("Store reset state must be an immutable value, did you forget to call toImmutable");r.set(n,a)})}.bind(this)),this.__evaluator.reset(),this.__changeObserver.reset(this.state)}}),Object.defineProperty(i.prototype,"__notify",{writable:!0,configurable:!0,value:function(){"use strict";this.__changeObserver.notifyObservers(this.state)}}),Object.defineProperty(i.prototype,"__handleAction",{writable:!0,configurable:!0,value:function(t,e,r){"use strict";return t.withMutations(function(t){this.debug&&o.dispatchStart(e,r),this.__stores.forEach(function(i,n){var a,s=t.get(n);try{a=i.handle(s,e,r)}catch(t){throw o.dispatchError(t.message),t}if(this.debug&&void 0===a){var u="Store handler must return a value, did you forget a return statement";throw o.dispatchError(u),new Error(u)}t.set(n,a),this.debug&&o.storeHandled(n,s,a)}.bind(this)),this.debug&&o.dispatchEnd(t)}.bind(this))}}),Object.defineProperty(i.prototype,"__batchStart",{writable:!0,configurable:!0,value:function(){"use strict";this.__batchDepth++}}),Object.defineProperty(i.prototype,"__batchEnd",{writable:!0,configurable:!0,value:function(){"use strict";if(this.__batchDepth--,this.__batchDepth<=0){if(this.__batchDispatchCount>0){this.__isDispatching=!0;try{this.__notify()}catch(t){throw this.__isDispatching=!1,t}this.__isDispatching=!1}this.__batchDispatchCount=0}}}),t.exports=i},function(t,e){e.dispatchStart=function(t,e){console.group&&(console.groupCollapsed("Dispatch: %s",t),console.group("payload"),console.debug(e),console.groupEnd())},e.dispatchError=function(t){console.group&&(console.debug("Dispatch error: "+t),console.groupEnd())},e.storeHandled=function(t,e,r){console.group&&e!==r&&console.debug("Store "+t+" handled action")},e.dispatchEnd=function(t){console.group&&(console.debug("Dispatch done, new state: ",t.toJS()),console.groupEnd())}},function(t,e,r){function i(t,e){"use strict";this.__prevState=t,this.__evaluator=e,this.__prevValues=n.Map(),this.__observers=[]}var n=r(2),o=r(7),a=r(8);Object.defineProperty(i.prototype,"notifyObservers",{writable:!0,configurable:!0,value:function(t){"use strict";if(this.__observers.length>0){var e=n.Map();this.__observers.slice(0).forEach(function(r){if(!r.unwatched){var i,n=r.getter,s=o(n),u=this.__prevState;this.__prevValues.has(s)?i=this.__prevValues.get(s):(i=this.__evaluator.evaluate(u,n),this.__prevValues=this.__prevValues.set(s,i));var c=this.__evaluator.evaluate(t,n);a(i,c)||(r.handler.call(null,c),e=e.set(s,c))}}.bind(this)),this.__prevValues=e}this.__prevState=t}}),Object.defineProperty(i.prototype,"onChange",{writable:!0,configurable:!0,value:function(t,e){"use strict";var r={getter:t,handler:e,unwatched:!1};return this.__observers.push(r),function(){var t=this.__observers.indexOf(r);t>-1&&(r.unwatched=!0,this.__observers.splice(t,1))}.bind(this)}}),Object.defineProperty(i.prototype,"reset",{writable:!0,configurable:!0,value:function(t){"use strict";this.__prevState=t,this.__prevValues=n.Map(),this.__observers=[]}}),t.exports=i},function(t,e,r){var i=r(2);t.exports=function(t,e){if(t.hasOwnProperty("__hashCode"))return t.__hashCode;var r=i.fromJS(t).hashCode();return e||(Object.defineProperty(t,"__hashCode",{enumerable:!1,configurable:!1,writable:!1,value:r}),Object.freeze(t)),r}},function(t,e,r){var i=r(2);t.exports=function(t,e){return i.is(t,e)}},function(t,e,r){function i(t){return u(t)&&s(t[t.length-1])}function n(t){return t[t.length-1]}function o(t){return t.slice(0,t.length-1)}function a(t){if(!c(t))throw new Error("Cannot create Getter from KeyPath: "+t);return[t,h]}var s=r(3).isFunction,u=r(3).isArray,c=r(10).isKeyPath,h=function(t){return t};t.exports={isGetter:i,getComputeFn:n,getDeps:o,fromKeyPath:a}},function(t,e,r){var i=r(3).isArray,n=r(3).isFunction;e.isKeyPath=function(t){return i(t)&&!n(t[t.length-1])}},function(t,e,r){function i(){"use strict";this.__cachedGetters=n.Map({})}var n=r(2),o=r(1).toImmutable,a=r(7),s=r(8),u=r(9).getComputeFn,c=r(9).getDeps,h=r(10).isKeyPath,l=r(9).isGetter,f=!1;Object.defineProperty(i.prototype,"evaluate",{writable:!0,configurable:!0,value:function(t,e){"use strict";if(h(e))return t.getIn(e);if(!l(e))throw new Error("evaluate must be passed a keyPath or Getter");var r=a(e);if(this.__isCached(t,e))return this.__cachedGetters.getIn([r,"value"]);var i=c(e).map(function(e){return this.evaluate(t,e)}.bind(this));if(this.__hasStaleValue(t,e)){var n=this.__cachedGetters.getIn([r,"args"]);if(s(n,o(i))){var p=this.__cachedGetters.getIn([r,"value"]);return this.__cacheValue(t,e,n,p),p}}if(f===!0)throw f=!1,new Error("Evaluate may not be called within a Getters computeFn");var _;f=!0;try{_=u(e).apply(null,i),f=!1}catch(t){throw f=!1,t}return this.__cacheValue(t,e,i,_),_}}),Object.defineProperty(i.prototype,"__hasStaleValue",{writable:!0,configurable:!0,value:function(t,e){"use strict";var r=a(e),i=this.__cachedGetters;return i.has(r)&&i.getIn([r,"stateHashCode"])!==t.hashCode()}}),Object.defineProperty(i.prototype,"__cacheValue",{writable:!0,configurable:!0,value:function(t,e,r,i){"use strict";var s=a(e);this.__cachedGetters=this.__cachedGetters.set(s,n.Map({value:i,args:o(r),stateHashCode:t.hashCode()}))}}),Object.defineProperty(i.prototype,"__isCached",{writable:!0,configurable:!0,value:function(t,e){"use strict";var r=a(e);return this.__cachedGetters.hasIn([r,"value"])&&this.__cachedGetters.getIn([r,"stateHashCode"])===t.hashCode()}}),Object.defineProperty(i.prototype,"untrack",{writable:!0,configurable:!0,value:function(t){"use strict"}}),Object.defineProperty(i.prototype,"reset",{writable:!0,configurable:!0,value:function(){"use strict";this.__cachedGetters=n.Map({})}}),t.exports=i},function(t,e,r){function i(t,e){var r={};return n(e,function(e,i){r[i]=t.evaluate(e)}),r}var n=r(3).each;t.exports=function(t){return{getInitialState:function(){return i(t,this.getDataBindings())},componentDidMount:function(){var e=this;e.__unwatchFns=[],n(this.getDataBindings(),function(r,i){var n=t.observe(r,function(t){var r={};r[i]=t,e.setState(r)});e.__unwatchFns.push(n)})},componentWillUnmount:function(){for(;this.__unwatchFns.length;)this.__unwatchFns.shift()()}}}},function(t,e,r){function i(t){"use strict";return this instanceof i?(this.__handlers=o({}),t&&a(this,t),void this.initialize()):new i(t)}function n(t){return t instanceof i}var o=r(2).Map,a=r(3).extend,s=r(1).toJS,u=r(1).toImmutable;Object.defineProperty(i.prototype,"initialize",{writable:!0,configurable:!0,value:function(){"use strict"}}),Object.defineProperty(i.prototype,"getInitialState",{writable:!0,configurable:!0,value:function(){"use strict";return o()}}),Object.defineProperty(i.prototype,"handle",{writable:!0,configurable:!0,value:function(t,e,r){"use strict";var i=this.__handlers.get(e);return"function"==typeof i?i.call(this,t,r,e):t}}),Object.defineProperty(i.prototype,"handleReset",{writable:!0,configurable:!0,value:function(t){"use strict";return this.getInitialState()}}),Object.defineProperty(i.prototype,"on",{writable:!0,configurable:!0,value:function(t,e){"use strict";this.__handlers=this.__handlers.set(t,e)}}),Object.defineProperty(i.prototype,"serialize",{writable:!0,configurable:!0,value:function(t){"use strict";return s(t)}}),Object.defineProperty(i.prototype,"deserialize",{writable:!0,configurable:!0,value:function(t){"use strict";return u(t)}}),t.exports=i,t.exports.isStore=n}])});